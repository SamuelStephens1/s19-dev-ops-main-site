---
import styles from './Header.module.css';
import HeaderLink from './HeaderLink.astro';

const SITE_TITLE = 'Signal Development Operations LLC';
---

<header class={styles.mainNav} data-role="main-nav" data-expanded="false">
  <div class={`container ${styles.mainNavContainer}`}>
    <div class={styles.logo}>
      <a href="/"><img src="/logo.png" alt={`${SITE_TITLE} logo`} /></a>
    </div>

    <!-- ðŸ‘‡ CTA (visible on scroll, mobile only) -->
    <div data-el="mobile-cta" class={styles.mobileCta} data-visible="false">
      <a href="https://calendly.com/signaldevops/consultation">Schedule a Consultation</a>
    </div>

    <!-- Desktop nav (hidden on mobile) -->
    <nav class={styles.links} aria-label="Primary">
      <HeaderLink href="/">Home</HeaderLink>
      <HeaderLink href="/services">Services</HeaderLink>
      <HeaderLink href="/resources">Resources</HeaderLink>
      <HeaderLink href="/about">About</HeaderLink>
      <HeaderLink href="/blog">Blog</HeaderLink>
    </nav>

    <div class={styles.rightStack}>
      <button
        data-el="menu-btn"
        class={styles.menuButton}
        aria-label="Open menu"
        aria-controls="mobile-menu"
        aria-expanded="false"
        type="button"
      >
        <svg class={styles.menuIcon} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
          <line x1="3" y1="6"  x2="21" y2="6" />
          <line x1="3" y1="12" x2="21" y2="12" />
          <line x1="3" y1="18" x2="21" y2="18" />
        </svg>
      </button>
    </div>

    <div class={styles.desktopCta} data-el="desktop-cta" data-visible="false">
      <a href="https://calendly.com/signaldevops/consultation">Schedule a Consultation</a>
    </div>

    <nav
      id="mobile-menu"
      data-el="mobile-menu"
      class={styles.mobileMenu}
      aria-label="Mobile primary"
      data-open="false"
    >
      <HeaderLink href="/">Home</HeaderLink>
      <HeaderLink href="/services">Services</HeaderLink>
      <HeaderLink href="/resources">Resources</HeaderLink>
      <HeaderLink href="/about">About</HeaderLink>
      <HeaderLink href="/blog">Blog</HeaderLink>
    </nav>
  </div>
</header>

<script client:load>
  const header      = document.querySelector('[data-role="main-nav"]');
  const btn         = document.querySelector('[data-el="menu-btn"]');
  const menu        = document.querySelector('[data-el="mobile-menu"]');
  const ctaDesktop  = document.querySelector('[data-el="desktop-cta"]');
  const ctaMobile   = document.querySelector('[data-el="mobile-cta"]');

  btn?.addEventListener('click', () => {
    const open = menu?.dataset.open === 'true';
    if (menu) menu.dataset.open = (!open).toString();
    btn?.setAttribute('aria-expanded', (!open).toString());
  });

  window.addEventListener('resize', () => {
    if (window.innerWidth >= 721 && menu) {
      menu.dataset.open = 'false';
      btn?.setAttribute('aria-expanded', 'false');
    }
    onScroll();
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && menu) {
      menu.dataset.open = 'false';
      btn?.setAttribute('aria-expanded', 'false');
    }
  });

  const onScroll = () => {
    const scrolled = window.scrollY > 50;

    if (window.innerWidth <= 720) {
      ctaMobile?.setAttribute('data-visible', scrolled ? 'true' : 'false');
      ctaDesktop?.setAttribute('data-visible', 'false');
    } else {
      ctaMobile?.setAttribute('data-visible', 'false');
      ctaDesktop?.setAttribute('data-visible', scrolled ? 'true' : 'false');
    }
  };
  window.addEventListener('scroll', onScroll, { passive: true });
  onScroll();
</script>
